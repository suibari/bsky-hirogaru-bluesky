<!DOCTYPE html>
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta property="og:title" content="ひろがるBluesky!">
<meta property="og:description" content="Blueskyの相関図を作成して遊べるアプリです">
<meta property="og:image" content="https://hirogaru-bluesky.fly.dev/img/ogp.jpg">
<meta property="og:url" content="https://hirogaru-bluesky.fly.dev/">
<meta property="og:type" content="website">

<title>ひろがるBluesky!</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.1/p5.js"></script>
<script src="https://bernii.github.io/gauge.js/dist/gauge.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<link rel="icon" type="image/x-icon" href="./img/favicon.ico" sizes="256x256">
<link rel="icon" type="image/x-icon" href="./img/favicon.ico" sizes="32x32">
<style>
    body, html {
        margin: 0;
        padding: 0;
        background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
        background-size: 400% 400%;
        animation: gradient 60s ease infinite;
        height: 100vh;
        overflow: hidden;
    }
    @keyframes gradient {
        0% {
            background-position: 0% 50%;
        }
        50% {
            background-position: 100% 50%;
        }
        100% {
            background-position: 0% 50%;
        }
    }
    #titleContainer {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        color: white;
        height: 100%;
        width: 100%;
    }
    #title {
        font-size: 3em;
        margin-bottom: 20px;
        animation: fadeIn 2s ease-out;
    }
    #subtitle {
        font-size: 1.1em;
        opacity: 0;
        animation: slideIn 2s ease-out forwards;
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    @keyframes slideIn {
        from { transform: translateY(-20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    #cy {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        position: fixed;
        z-index: 0;
    }
    #inputbuttonContainer {
        position: absolute;
        top: 20px;
        left: 10px;
    }
    #inputbuttonContainer input {
        margin-bottom: 10px;
    }
    #fetchButton {
        width: auto; /* ボタンの幅はテキストの幅に合わせます */
    }
    @media screen and (max-width: 600px) {
        #inputbuttonContainer {
            position: absolute;
            top: 20px;
            left: 10px;
        }
        #fetchButton {
            display: block;
        }
    }
    #loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
    }
    .custom-spinner {
        width: 70px;
        height: 70px;
        color: #333333;
        border-width: 1rem;
    }
    #shareButton {
        position: fixed;
        top: 8px;
        right: 10px;
        font-size: 40px;
        z-index: 10;
        cursor: pointer;
    }
    #popupImageShare {
        max-width: 100%;
        max-height: 100%;
        width: auto;
        height: auto;
        object-fit: contain;
    }
    #helpButton {
        position: fixed;
        bottom: 10px;
        right: 10px;
        font-size: 40px;
        z-index: 10;
        cursor: pointer;
    }
    #helpModal {
        z-index: 8888;
    }
    .github-icon {
        font-size: 20px;
        color: black; /* 黒色に設定 */
        margin-right: 10px; /* GitHubアイコンの右に余白を追加 */
    }
    .bluesky-icon {
        width: 24px; /* Blueskyアイコンのサイズを調整 */
        height: 24px;
        margin-right: 10px; /* Blueskyアイコンの右に余白を追加 */
    }
    #card {
        position: fixed;
        bottom: 10px;
        left: 10px;
        display: none;
        width: 300px;
        z-index: 7777;
    }
    #gauge-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 400px;
        height: 400px;
    }
    #socialButton {
        margin-top: 5px;
    }
    .card-title {
        margin-top: 10px; /* 任意の値を指定 */
    }
    #bottom-left {
        position: fixed; /* ページスクロールに関係なく固定 */
        bottom: 10px; /* 下からの位置調整 */
        left: 10px; /* 右からの位置調整 */
        color: white; /* テキスト色 */
        border-radius: 5px; /* 角丸 */
        font-family: "Yu Gothic", sans-serif; /* フォント */
        font-size: 2vw; /* フォントサイズ */
        display: none;
    }
</style>
</head>

<body>
<!-- Emblem -->
<div id="titleContainer">
    <div id="title">ひろがるBluesky! </div>
    <div id="subtitle">
        <div>左上にBlueskyのハンドル名を入力して、</div>
        <div>無限に広がる相関図をつくろう</div>
        <div>利用にログインやインストールは必要ありません</div>
        <div>わからないことがあれば右下のヘルプをどうぞ</div>
    </div>
</div>
<!-- Cytoscape -->
<div id="cy"></div>
<!-- Input & Button -->
<div id="containerWrapper">
    <div id="inputbuttonContainer">
        <input type="text" id="fetchInput" placeholder="handle.bsky.social">
        <button id="fetchButton" type="button" class="btn btn-dark btn-sm">Generate!</button>
    </div>
    <!-- Share Button -->
    <div id="shareButton" style="display: none;" onclick="shareGraph()">
        <i class="bi bi-camera-fill"></i>
    </div>
</div>
<!-- alert -->
<div id="alert" class="alert alert-danger fixed-top" role="alert" style="z-index: 9999; display: none;">テキストが入力されていません</div>
<!-- Loading Spinner -->
<div id="loading" style="display: none;">
    <div class="spinner-border custom-spinner" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>
<!-- Node Tooltip -->
<!-- <div id="nodeTooltip" class="node-tooltip">
    <div id="tooltipContent" class="text-center"></div>
    <button id="regenerateButton" class="btn btn-primary">この人を中心にグラフを再生成</button>
</div> -->
<!-- Share Popup -->
<div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="shareModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <img id="popupImageShare" src="" class="img-fluid mb-3" alt="Share Image">
                <ol>
                    <li>画像を右クリックか長押しでコピーしてください</li>
                    <li><a href="https://bsky.app/intent/compose?text=%23%E3%81%B2%E3%82%8D%E3%81%8C%E3%82%8BBluesky" target="_blank">こちら</a>をクリックして、開いたポスト画面に画像をペーストしてシェア！</li>
                </ol>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- Help Icon -->
<div id="helpButton" data-bs-toggle="modal" data-bs-target="#helpModal">
    <i class="bi bi-question-circle"></i>
</div>
<!-- Help Popup -->
<div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="helpModalLabel">ひろがるBluesky!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>使い方</h6>
                    <ul>
                        <li><a href="https://bsky.app/" target="_blank">Bluesky</a>のハンドル名(～.bsky.socialまで)を入れて<b>Generate!</b>を押してください</li>
                        <li>その人の<b>相関図</b>を作成します</li>
                        <li>相関図の中心が自分、そこに近づくほど仲良しの人です</li>
                        <li><b>利用にあたりパスワードを入力する必要がないので、ユーザ情報が漏れる心配もいっさいありません</b></li>
                    </ul>
                <h6>相関図のしくみ</h6>
                    <ul>
                        <li>仲良し度は<b>リプライやいいねの頻度</b>で変わります</li>
                        <li>相関図に出てくる人が少ない時は、Blueskyでいいね・リプライしよう！</li>
                        <li>結果はすぐに反映されるので、また相関図を作ってみよう！</li>
                        <li>相関図は大体のアカウントなら<b>20秒弱</b>で生成できるはずです</li>
                    </ul>
                <h6>相関図で遊ぼう</h6>
                    <ul>
                        <li>各ユーザのアイコンをクリックするとメニューが出ます</li>
                        <li>メニュー選択でプロフィールに飛んだり、その人を中心に相関図を再生成できます</li>
                        <li>右上のシェアボタンで相関図を画像として表示します。コピペしてBlueskyに投稿！</li>
                        <li>生成時間は主にポスト数で変わってきますが、1分はかかりません。生成時間が長すぎる時はリロードしてみてください</li>
                    </ul>
                <h6>免責事項</h6>
                    <ul>
                        <li>本サービスによって生じた損害について開発者は責任を負いません</li>
                        <li>本サービスは予告なく停止する可能性があります</li>
                    </ul>
                <h6>その他</h6>
                    <ul>
                        <li>ご意見ご要望は<a href="https://bsky.app/profile/suibari-cha.bsky.social" target="_blank">開発者まで</a>お気軽にどうぞ！</li>
                    </ul>
            </div>
            <div class="modal-footer d-flex justify-content-center">
                <a href="https://github.com/suibari/bsky-hirogaru-bluesky" target="_blank" class="modal-github-icon"><i class="bi bi-github github-icon"></i></a>
                <a href="https://bsky.app/profile/suibari-cha.bsky.social" target="_blank"><img src="https://cdn.worldvectorlogo.com/logos/bluesky-1.svg" alt="Bluesky Icon" class="bluesky-icon"></a>
            </div>
        </div>
    </div>
</div>
<!-- Bootstrap Card -->
<div id="card" class="card">
    <div class="card-body">
        <h5 class="card-title" id="cardTitle"></h5>
        <a href="#" id="cardLink" class="card-link" target="_blank"><h6 class="card-subtitle mb-2 text-muted" id="cardSubtitle"></h6></a>
        <button id="regenerateButton" class="btn btn-primary">この人を中心に相関図を再生成</button>
        <button id="socialButton" class="btn btn-primary">この人との関係を見る</button>
    </div>
    <span id="card-badge" class="badge position-absolute top-0 end-0 mt-1 me-1"></span>
</div>
<!-- Gauge -->
<canvas id="gauge-container"></canvas>
<!-- Logo -->
<div id="bottom-left"> <!-- 右下に表示する要素 -->
    <p>#ひろがるBluesky!</p>
</div>

<script src="perticle.js"></script>
<script src="client.js"></script>

</body>