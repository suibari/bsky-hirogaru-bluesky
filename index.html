<!DOCTYPE html>
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>ひろがるBluesky!</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<style>
    body, html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    #cy {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        position: fixed;
        background: linear-gradient(-225deg, #2CD8D5 0%, #C5C1FF 56%, #FFBAC3 100%);
        z-index: 1;
    }
    #inputbuttonContainer {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 10;
        display: flex;
        align-items: center;
    }
    #inputbuttonContainer input {
        margin-right: 10px;
    }
    #loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
    }
    #shareButton {
        position: fixed;
        top: 10px;
        right: 10px;
        font-size: 24px;
        z-index: 10;
        cursor: pointer;
    }
    #popupImageShare {
        max-width: 100%;
        max-height: 100%;
        width: auto;
        height: auto;
        object-fit: contain;
    }
    #helpButton {
        position: fixed;
        bottom: 10px;
        right: 10px;
        font-size: 24px;
        z-index: 10;
        cursor: pointer;
    }
    #helpModal {
        z-index: 8888;
    }
    .github-icon {
        font-size: 20px;
        color: black; /* 黒色に設定 */
        margin-right: 10px; /* GitHubアイコンの右に余白を追加 */
    }
    .bluesky-icon {
        width: 24px; /* Blueskyアイコンのサイズを調整 */
        height: 24px;
        margin-right: 10px; /* Blueskyアイコンの右に余白を追加 */
    }
    #card {
        position: fixed;
        bottom: 10px;
        left: 10px;
        display: none;
        width: 300px;
        z-index: 7777;
    }
</style>
</head>

<body>

<div id="cy"></div>
<!-- Input & Nutton -->
<div id="inputbuttonContainer">
    <input type="text" id="fetchInput" placeholder="handle.bsky.social">
    <button id="fetchButton">Generate!</button>
</div>
<!-- alert -->
<div id="alert" class="alert alert-danger" role="alert" style="z-index: 9999; display: none;">テキストが入力されていません</div>
<!-- Share Button -->
<div id="shareButton" onclick="shareGraph()">   
    <i class="bi bi-share-fill"></i>
</div>
<!-- Loading Spinner -->
<div id="loading" style="display: none;">
    <div class="spinner-border text-secondary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>
<!-- Node Tooltip -->
<!-- <div id="nodeTooltip" class="node-tooltip">
    <div id="tooltipContent" class="text-center"></div>
    <button id="regenerateButton" class="btn btn-primary">この人を中心にグラフを再生成</button>
</div> -->
<!-- Share Popup -->
<div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="shareModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body text-center">
                <img id="popupImageShare" src="" class="img-fluid mb-3" alt="Share Image">
                <p>画像をコピーして<a href="https://bsky.app/intent/compose?text=%23%E3%81%B2%E3%82%8D%E3%81%8C%E3%82%8BBluesky" target="_blank">Bluesky</a>にペーストすればシェアできます！</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- Help Icon -->
<div id="helpButton" data-bs-toggle="modal" data-bs-target="#helpModal">
    <i class="bi bi-question-circle" style="font-size: 32px;"></i>
</div>
<!-- Help Popup -->
<div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="helpModalLabel">ひろがるBluesky!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>使い方</h6>
                    <ul>
                        <li><a href="https://bsky.app/" target="_blank">Bluesky</a>のハンドル名(～.bsky.socialまで)を入れて<b>Generate!</b>を押してください</li>
                        <li>その人の<b>相関図</b>を作成します</li>
                        <li>相関図の中心が自分、そこに近づくほど仲良しの人です</li>
                        <li>仲良し度はリプライやいいねの頻度で変わるので、しばらくしたら結果が変わるかも？</li>
                        <li>相関図は大体のアカウントなら<b>20秒弱</b>で生成できるはずです</li>
                    </ul>
                <h6>TIPS</h6>
                    <ul>
                        <li>各ユーザのアイコンをクリックするとメニューが出ます</li>
                        <li>メニュー選択でプロフィールに飛んだり、その人を中心に相関図を再生成できます</li>
                        <li>右上のシェアボタンで相関図を画像として表示します。コピペしてBlueskyに投稿！</li>
                        <li>生成時間は主にポスト数で変わってきますが、1分はかかりません。生成時間が長すぎる時はリロードしてみてください</li>
                    </ul>
                <h6>免責事項</h6>
                    <ul>
                        <li>本サービスによって生じた損害について開発者は責任を負いません</li>
                        <li>本サービスは予告なく停止する可能性があります</li>
                    </ul>
                <h6>その他</h6>
                    <ul>
                        <li>ご意見ご要望は<a href="https://bsky.app/profile/suibari-cha.bsky.social" target="_blank">開発者まで</a>お気軽にどうぞ！</li>
                    </ul>
            </div>
            <div class="modal-footer d-flex justify-content-center">
                <a href="https://github.com/suibari/bsky-hirogaru-bluesky" target="_blank" class="modal-github-icon"><i class="bi bi-github github-icon"></i></a>
                <a href="https://bsky.app/profile/suibari-cha.bsky.social" target="_blank"><img src="https://cdn.worldvectorlogo.com/logos/bluesky-1.svg" alt="Bluesky Icon" class="bluesky-icon"></a>
            </div>
        </div>
    </div>
</div>
<!-- Bootstrap Card -->
<div id="card" class="card">
    <div class="card-body">
        <h5 class="card-title" id="cardTitle"></h5>
        <a href="#" id="cardLink" class="card-link" target="_blank"><h6 class="card-subtitle mb-2 text-muted" id="cardSubtitle"></h6></a>
        <button id="regenerateButton" class="btn btn-primary">この人を中心に相関図を再生成</button>
    </div>
</div>

<script src="client.js"></script>

</body>